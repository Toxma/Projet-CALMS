<!DOCTYPE html><html><head>
      <title>documentation</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Matteo\.vscode-oss\extensions\shd101wyy.markdown-preview-enhanced-0.8.10-universal\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="documentation-projet-calms">Documentation Projet CALMS </h1>
<hr>
<h2 id="toc">TOC </h2>
<ul>
<li><a href="#documentation-projet-calms">Documentation Projet CALMS</a>
<ul>
<li><a href="#toc">TOC</a></li>
<li><a href="#environnement-de-d%C3%A9part">Environnement de départ</a></li>
<li><a href="#exercice-1--exe%CC%81cution-avec-chroot">Exercice 1 : Exécution avec chroot</a>
<ul>
<li><a href="#configuration-du-script">Configuration du script</a></li>
<li><a href="#configuration-de-lenvironnement-chroot">Configuration de l'environnement chroot</a></li>
<li><a href="#cr%C3%A9ation-du-chroot">Création du chroot</a></li>
</ul>
</li>
<li><a href="#exercice-2--ex%C3%A9cution-sous-lxc">Exercice 2 : Exécution sous LXC</a>
<ul>
<li><a href="#installation-lxc">Installation LXC</a></li>
<li><a href="#cr%C3%A9ation-du-conteneur-lxc">Création du conteneur LXC</a></li>
<li><a href="#d%C3%A9marrage-et-connection-au-conteneur-lxc">Démarrage et connection au conteneur LXC</a></li>
</ul>
</li>
<li><a href="#exercice-3--ex%C3%A9cution-sous-systemd-nspawn">Exercice 3 : Exécution sous systemd-nspawn</a>
<ul>
<li><a href="#pr%C3%A9paration-de-lenvironnement">Préparation de l'environnement</a></li>
<li><a href="#cr%C3%A9ation-du-conteneur-systemd-nspawn">Création du conteneur systemd-nspawn</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="environnement-de-départ">Environnement de départ </h2>
<ul>
<li>Machine crée via Vagrant (./Vagrant/Vagrantfile)</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ neofetch
       _,met<span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$gg</span><span class="token builtin class-name">.</span>          vagrant@zdeploy
    ,g<span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$P</span><span class="token builtin class-name">.</span>       ---------------
  ,g<span class="token variable">$$</span>P<span class="token string">"     "</span>"<span class="token string">"Y<span class="token variable">$$</span>."</span><span class="token builtin class-name">.</span>        OS: Debian GNU/Linux <span class="token number">11</span> <span class="token punctuation">(</span>bullseye<span class="token punctuation">)</span> x86_64
 ,<span class="token variable">$$</span>P<span class="token string">'              `$$$.     Host: VirtualBox 1.2
'</span>,<span class="token variable">$$</span>P       ,ggs.     <span class="token variable"><span class="token variable">`</span>$$b:   Kernel: <span class="token number">5.10</span>.0-26-amd64
<span class="token variable">`</span></span>d$<span class="token string">$'     ,$P"'</span>   <span class="token builtin class-name">.</span>    <span class="token variable">$$</span>$    Uptime: <span class="token number">11</span> mins
 <span class="token variable">$$</span>P      d<span class="token string">$'     ,    $$P    Packages: 492 (dpkg)
 $$:      $$.   -    ,d$$'</span>    Shell: <span class="token function">bash</span> <span class="token number">5.1</span>.4
 <span class="token variable">$$</span><span class="token punctuation">;</span>      Y<span class="token variable">$b</span>._   _,d<span class="token variable">$P</span><span class="token string">'      Resolution: preferred
 Y$$.    `.`"Y$$$$P"'</span>         Terminal: /dev/pts/0
 <span class="token variable"><span class="token variable">`</span>$$b      "-.__              CPU: AMD Ryzen <span class="token number">5</span> <span class="token number">5600</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @ <span class="token number">3</span>.499GHz
  <span class="token variable">`</span></span>Y<span class="token variable">$$</span>                        GPU: 00:02.0 VMware SVGA II Adapter
   <span class="token variable"><span class="token variable">`</span>Y$$.                      Memory: 72MiB / 1970MiB
     <span class="token variable">`</span></span><span class="token variable">$$</span>b.
       <span class="token variable"><span class="token variable">`</span>Y$$b.                                         
          <span class="token variable">`</span></span>"Y<span class="token variable">$b</span>._                                     
              `<span class="token string">""</span>"
</code></pre><hr>
<h2 id="exercice-1--exécution-avec-chroot">Exercice 1 : Exécution avec chroot </h2>
<h3 id="configuration-du-script">Configuration du script </h3>
<ul>
<li>On rend le script exécutable en utilisant la commande <code>chmod +x exo1.sh</code></li>
<li>On voit désormais grâce à <code>ls -l</code> que les permissions du script permettent de l'exécuter</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">chmod</span> +x exo1.sh 
vagrant@zdeploy:~$ <span class="token function">ls</span> <span class="token parameter variable">-l</span>
total <span class="token number">4</span>
-rwxr-xr-x <span class="token number">1</span> vagrant vagrant <span class="token number">921</span> Nov  <span class="token number">6</span> <span class="token number">22</span>:29 exo1.sh
</code></pre><ul>
<li>Dans mon script le binaire msnake se situe à /tmp/msnake</li>
</ul>
<h3 id="configuration-de-lenvironnement-chroot">Configuration de l'environnement chroot </h3>
<ul>
<li>On lance le script grâce à la commande <code>./exo1.sh</code></li>
<li>Ce script va permettre :
<ul>
<li>Crée l'arborescence ci-dessous</li>
<li>Copier les binaires de <strong>bash</strong>, <strong>ls</strong> et <strong>msnake</strong></li>
<li>Mettre les droits sur le binaire msnake</li>
<li>Copier les librairies nécessaires de <strong>/lib</strong> et <strong>/lib64</strong></li>
<li>Copier les librairies du terminal présentent dans <strong>/lib/terminfo</strong></li>
</ul>
</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ tree exo1
exo1
├── bin
│   ├── <span class="token function">bash</span>
│   ├── <span class="token function">ls</span>
│   └── msnake
├── lib
│   ├── libc.so.6
│   ├── libdl.so.2
│   ├── libncurses.so.6
│   ├── libpcre2-8.so.0
│   ├── libpthread.so.0
│   ├── libselinux.so.1
│   ├── libtinfo.so.6
│   └── terminfo
│       ├── E
│       │   ├── Eterm
│       │   └── Eterm-color -<span class="token operator">&gt;</span> Eterm
│       ├── a
│       │   └── ansi
│       ├── c
│       │   ├── cons25
│       │   ├── cons25-debian
│       │   └── cygwin
│       ├── d
│       │   └── dumb
│       ├── h
│       │   └── hurd
│       ├── l
│       │   └── linux
│       ├── m
│       │   ├── mach
│       │   ├── mach-bold
│       │   ├── mach-color
│       │   ├── mach-gnu
│       │   └── mach-gnu-color
│       ├── p
│       │   └── pcansi
│       ├── r
│       │   ├── rxvt
│       │   ├── rxvt-basic
│       │   ├── rxvt-m -<span class="token operator">&gt;</span> rxvt-basic
│       │   ├── rxvt-unicode
│       │   └── rxvt-unicode-256color
│       ├── s
│       │   ├── <span class="token function">screen</span>
│       │   ├── screen-256color
│       │   ├── screen-256color-bce
│       │   ├── screen-bce
│       │   ├── screen-s
│       │   ├── screen-w
│       │   ├── screen.xterm-256color
│       │   └── sun
│       ├── t
│       │   ├── tmux
│       │   └── tmux-256color
│       ├── <span class="token function">v</span>
│       │   ├── vt100
│       │   ├── vt102
│       │   ├── vt220
│       │   └── vt52
│       ├── w
│       │   ├── wsvt25
│       │   └── wsvt25m
│       └── x
│           ├── xterm
│           ├── xterm-256color
│           ├── xterm-color
│           ├── xterm-debian -<span class="token operator">&gt;</span> xterm
│           ├── xterm-mono
│           ├── xterm-r5
│           ├── xterm-r6
│           ├── xterm-vt220
│           └── xterm-xfree86
└── lib64
    └── ld-linux-x86-64.so.2
</code></pre><h3 id="création-du-chroot">Création du chroot </h3>
<ul>
<li>Une fois l'arborescence créée ainsi que les fichiers nécessaires copiés nous allons créer le chroot</li>
<li>Pour se faire, il faut utiliser la commande <code>sudo chroot exo1 msnake</code>, ceci va :
<ul>
<li>Créer l'environnement chroot dans le directory exo1</li>
<li>Lancer le binaire msnake</li>
</ul>
</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">sudo</span> <span class="token function">chroot</span> exo1/ msnake
</code></pre><p><img src="images/msnake.png" alt="Alt text"></p>
<blockquote>
<p>Tout fonctionne comme prévu. On peut désormais jouer à snake !!!</p>
</blockquote>
<hr>
<h2 id="exercice-2--exécution-sous-lxc">Exercice 2 : Exécution sous LXC </h2>
<h3 id="installation-lxc">Installation LXC </h3>
<ul>
<li>Pour ce 2ème exercice nous devons créer un conteneur grâce à LXC (Linux Containers). Pour se faire nous devons commencer par installer le paquet lxc sur notre environnement de travail, ceci grâce à la commande ci-dessous.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> lxc
</code></pre><h3 id="création-du-conteneur-lxc">Création du conteneur LXC </h3>
<ul>
<li>Une fois le paquet installé, nous pouvons désormais l'utiliser afin de créer des conteneurs. Pour faire ceci nous allons utiliser la commande ci-dessous qui va nous permettre de précisez les informations suivantes :</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">sudo</span> lxc-create <span class="token parameter variable">-n</span> alpine-container <span class="token parameter variable">-t</span> download -- <span class="token parameter variable">--dist</span> alpine <span class="token parameter variable">--release</span> edge
</code></pre><table>
<thead>
<tr>
<th style="text-align:left">Option</th>
<th style="text-align:left">Utilité</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">lxc-create</td>
<td style="text-align:left">Créer un conteneur avec lxc</td>
</tr>
<tr>
<td style="text-align:left">-n alpine-container</td>
<td style="text-align:left">Nommé ce conteneur alpine-container</td>
</tr>
<tr>
<td style="text-align:left">-t download</td>
<td style="text-align:left">Utilisé une template de téléchargement</td>
</tr>
<tr>
<td style="text-align:left">--</td>
<td style="text-align:left">Séparation des options de la commande et de la template</td>
</tr>
<tr>
<td style="text-align:left">--dist alpine</td>
<td style="text-align:left">Spécifie que nous voulons une distribution alpine</td>
</tr>
<tr>
<td style="text-align:left">--release edge</td>
<td style="text-align:left">Donne la version de la distribution, ici la dernière</td>
</tr>
</tbody>
</table>
<ul>
<li>Une fois la commande lancée, on peut voir dans l'extrait du terminal ci-dessous, nous arrivons sur un shell interactif où 2 versions d'alpine linux (amd64, arm64) sont proposées. Ceci représente l'architecture du processeur nous devons donc choisir celle qui correspond à notre environnement. Dans mon cas amd64.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>DIST    RELEASE ARCH    VARIANT BUILD
---
alpine  edge    amd64   default 20231105_13:00
alpine  edge    arm64   default 20231105_13:01
---

Architecture:
amd64

Downloading the image index
Downloading the rootfs
Downloading the metadata
The image cache is now ready
Unpacking the rootfs

---
You just created an Alpinelinux edge x86_64 <span class="token punctuation">(</span>20231105_13:00<span class="token punctuation">)</span> container.
</code></pre><blockquote></blockquote>
<ul>
<li>Le résultat de la commande nous valide la création de notre conteneur.</li>
</ul>
<h3 id="démarrage-et-connection-au-conteneur-lxc">Démarrage et connection au conteneur LXC </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">sudo</span> lxc-start <span class="token parameter variable">-n</span> alpine-container
</code></pre><ul>
<li>Ensuite on lance le conteneur grâce à la commande juste au dessus.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">sudo</span> lxc-attach <span class="token parameter variable">-n</span> alpine-container
</code></pre><ul>
<li>Une fois le conteneur up nous allons nous connecter dessus afin de pouvoir réaliser la suite de l'exercice grâce à la commande ci-dessus.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>/ <span class="token comment"># apk add neofetch</span>
/ <span class="token comment"># neofetch</span>
       .hddddddddddddddddddddddh.          root@alpine-container 
      :dddddddddddddddddddddddddd:         --------------------- 
     /dddddddddddddddddddddddddddd/        OS: Alpine Linux v3.18 x86_64 
    +dddddddddddddddddddddddddddddd+       Host: VirtualBox <span class="token number">1.2</span> 
  <span class="token variable"><span class="token variable">`</span>sdddddddddddddddddddddddddddddddds<span class="token variable">`</span></span>     Kernel: <span class="token number">5.10</span>.0-26-amd64 
 <span class="token variable"><span class="token variable">`</span>ydddddddddddd++hdddddddddddddddddddy<span class="token variable">`</span></span>    Uptime: <span class="token number">39</span> secs 
.hddddddddddd+<span class="token variable"><span class="token variable">`</span>  <span class="token variable">`</span></span>+ddddh:-sdddddddddddh.   Packages: <span class="token number">35</span> <span class="token punctuation">(</span>apk<span class="token punctuation">)</span> 
hdddddddddd+<span class="token variable"><span class="token variable">`</span>      <span class="token variable">`</span></span>+y:    .sddddddddddh   Shell: <span class="token function">bash</span> <span class="token number">5.2</span>.15 
ddddddddh+<span class="token variable"><span class="token variable">`</span>   <span class="token variable">`</span></span>//<span class="token variable"><span class="token variable">`</span>   <span class="token variable">`</span></span><span class="token builtin class-name">.</span><span class="token variable"><span class="token variable">`</span>     <span class="token parameter variable">-sddddddddd</span>   Resolution: preferred 
ddddddh+<span class="token variable">`</span></span>   <span class="token variable"><span class="token variable">`</span>/hddh/<span class="token variable">`</span></span>   <span class="token variable"><span class="token variable">`</span>:s-    <span class="token parameter variable">-sddddddd</span>   CPU: AMD Ryzen <span class="token number">5</span> <span class="token number">5600</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> @ <span class="token number">3</span>.499GHz 
ddddh+<span class="token variable">`</span></span>   <span class="token variable"><span class="token variable">`</span>/+/dddddh/<span class="token variable">`</span></span>   <span class="token variable"><span class="token variable">`</span>+s-    <span class="token parameter variable">-sddddd</span>   Memory: 5MiB / 1970MiB 
ddd+<span class="token variable">`</span></span>   <span class="token variable"><span class="token variable">`</span>/o<span class="token variable">`</span></span> :dddddddh/<span class="token variable"><span class="token variable">`</span>   <span class="token variable">`</span></span>oy-    .yddd
hdddyo+ohddyosdddddddddho+oydddy++ohdddh                           
.hddddddddddddddddddddddddddddddddddddh.                           
 <span class="token variable"><span class="token variable">`</span>yddddddddddddddddddddddddddddddddddy<span class="token variable">`</span></span>
  <span class="token variable"><span class="token variable">`</span>sdddddddddddddddddddddddddddddddds<span class="token variable">`</span></span>
    +dddddddddddddddddddddddddddddd+
     /dddddddddddddddddddddddddddd/
      :dddddddddddddddddddddddddd:
       .hddddddddddddddddddddddh.
</code></pre><hr>
<h2 id="exercice-3--exécution-sous-systemd-nspawn">Exercice 3 : Exécution sous systemd-nspawn </h2>
<h3 id="préparation-de-lenvironnement">Préparation de l'environnement </h3>
<ul>
<li>Tout d'abord nous devons commencer par installer les paquets que nous avons besoin :
<ul>
<li><strong>debootstrap</strong> : permet d'installer un système Debian de base dans un sous-répertoire</li>
<li><strong>systemd-container</strong> : outil pour gérer les containers systemd-nspawn</li>
</ul>
</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">debootstrap</span> systemd-container
</code></pre><ul>
<li>On créer le répertoire debian10 où nous allons mettre notre système debian10</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">mkdir</span> ~/debian10
</code></pre><ul>
<li>Grâce au paquet debootstrap nous allons pouvoir installer créer un système de fichier minimal d'une debian 10 dans le répertoire debian10 bien que dans mon cas ma machine hôte est sur debian 11. Ceci grâce à la commande ci-dessous.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">sudo</span> <span class="token function">debootstrap</span> buster ~/debian10 http://deb.debian.org/debian/
</code></pre><ul>
<li>Une fois le système de fichier de la debian 10 installé, on verifie l'installation. On peut voir que tout est prêt pour acceuillir notre conteneur.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ tree <span class="token parameter variable">-d</span> <span class="token parameter variable">-L</span> <span class="token number">1</span> debian10/
debian10/
├── bin -<span class="token operator">&gt;</span> usr/bin
├── boot
├── dev
├── etc
├── home
├── lib -<span class="token operator">&gt;</span> usr/lib
├── lib32 -<span class="token operator">&gt;</span> usr/lib32
├── lib64 -<span class="token operator">&gt;</span> usr/lib64
├── libx32 -<span class="token operator">&gt;</span> usr/libx32
├── media
├── mnt
├── opt
├── proc
├── root
├── run
├── sbin -<span class="token operator">&gt;</span> usr/sbin
├── srv
├── sys
├── tmp
├── usr
└── var
</code></pre><h3 id="création-du-conteneur-systemd-nspawn">Création du conteneur systemd-nspawn </h3>
<ul>
<li>Pour créer notre conteneur nous allons utilisé la commande ci-dessous. Elle va nous permettre de monter notre conteneur avec comme racine notre répertoire debian10. On voit bien lors de la commande qu'on rentre directement dans le conteneur et que le hostname change.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>vagrant@zdeploy:~$ <span class="token function">sudo</span> systemd-nspawn <span class="token parameter variable">-D</span> ~/debian10
Spawning container debian10 on /home/vagrant/debian10.
Press ^<span class="token punctuation">]</span> three <span class="token builtin class-name">times</span> within 1s to <span class="token function">kill</span> container.
root@debian10:~<span class="token comment">#</span>
</code></pre><ul>
<li>Une fois dans le conteneur on installe le paquet neofetch puis on l'exécute. Et on peut bien voir que la sortie nous montre que nous sommes dans une debian 10 bien que la machine hôte est une debian 11.</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>root@debian10:~<span class="token comment"># apt install neofetch</span>
root@debian10:~<span class="token comment"># neofetch </span>
       _,met<span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$gg</span><span class="token builtin class-name">.</span>          root@debian10 
    ,g<span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$P</span><span class="token builtin class-name">.</span>       ------------- 
  ,g<span class="token variable">$$</span>P<span class="token string">"     "</span>"<span class="token string">"Y<span class="token variable">$$</span>."</span><span class="token builtin class-name">.</span>        OS: Debian GNU/Linux <span class="token number">10</span> <span class="token punctuation">(</span>buster<span class="token punctuation">)</span> x86_64 
 ,<span class="token variable">$$</span>P<span class="token string">'              `$$$.     Host: VirtualBox 1.2 
'</span>,<span class="token variable">$$</span>P       ,ggs.     <span class="token variable"><span class="token variable">`</span>$$b:   Kernel: <span class="token number">5.10</span>.0-26-amd64 
<span class="token variable">`</span></span>d$<span class="token string">$'     ,$P"'</span>   <span class="token builtin class-name">.</span>    <span class="token variable">$$</span>$    Uptime: <span class="token number">3</span> hours, <span class="token number">34</span> mins 
 <span class="token variable">$$</span>P      d<span class="token string">$'     ,    $$P    Packages: 223 (dpkg) 
 $$:      $$.   -    ,d$$'</span>    Shell: <span class="token function">bash</span> <span class="token number">5.0</span>.3 
 <span class="token variable">$$</span><span class="token punctuation">;</span>      Y<span class="token variable">$b</span>._   _,d<span class="token variable">$P</span><span class="token string">'      CPU: AMD Ryzen 5 5600 6- (2) @ 3.499GHz 
 Y$$.    `.`"Y$$$$P"'</span>         Memory: 88MiB / 1970MiB 
 <span class="token variable"><span class="token variable">`</span>$$b      "-.__
  <span class="token variable">`</span></span>Y<span class="token variable">$$</span>                                                
   <span class="token variable"><span class="token variable">`</span>Y$$.
     <span class="token variable">`</span></span><span class="token variable">$$</span>b.
       <span class="token variable"><span class="token variable">`</span>Y$$b.
          <span class="token variable">`</span></span>"Y<span class="token variable">$b</span>._
              `<span class="token string">""</span>"
</code></pre><hr>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>